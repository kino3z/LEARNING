# 概率与期望

概率$dp$

$$P(B) = \sum{P(A)P(B | A)}$$

$B$事件是及格，$A$事件是$100$分以上，所以说$B$事件发生的概率是$A$发生的概率乘$A$发生的前提下$B$发生的概率。

$P(B | A) = \frac{P(A, B)}{P(A)}$。$A, B$不是独立事件，所以不能直接相乘。可以这么$A$发生的前提下$B$发生的概率。

期望$dp$

$E(A) = \sum{P(a_i) \times a_i} = \sum{E(a_i)}$;

经常会出现$a_i$的值一定的时候，也就是贡献一定的时候，有时会转化为求$P(a_i)$，$a_i$不同的时候，就需要单独计算了。

- HDU3853
- POJ2151

$f[i][j][k]$，选到第$i$个队伍，从前$j$个中选$k$个，所有合法情况的概率之和为$f[i][j][k]$。

所有队伍至少做出一个的概率就是$1 - f[n][m][0]$。所有队伍都做出$n$以下的概率是$f[i][m][n]$的前缀和。

- POJ3071

二进制性质优化概率dp

对于所有点建树，树状数组式建树，对于$i$层，编号从$0$开始，可以发现性质，当前`>> 1`之后是起父亲节点，当前`>> 1 xor 1`是其父亲节点的右节点。然后进行普通的转移。对于第$i$层，先把某个值右移$i - 1$层，然后异或$1$，相等，能打。什么骚操作。。。

- CF148D

$f[i][j]$表示剩余$i$只白鼠，$j$只黑鼠，$A$先手，胜利的概率。

$f[i][0] = 1$，因为$A$先手，如果没有黑鼠就赢了。

$f[0][i] = 0$，没有白鼠$B$胜利。

在这一场胜利有三种情况，这一次抓到白鼠，上一次$B$抓到黑鼠，跑出来只白鼠、这一次抓到白鼠，上一次$B$抓到黑鼠，跑出来只黑鼠。输出$f[w][b]$。

- POJ3744

  先考虑数值范围很小的情况，$a_i \leq 1000$，假如说$i$位置有雷，到达$i - 1$位置的概率乘以转移两步的概率就是到达$i + 1$位置的概率，然后跳过$i$位置的计算，中间分开的部分用矩阵快速幂优化一下。

- BZOJ4318

$f[i][j]$表示到了$i$位置，连续$1$的长度为$j$，的期望分数。$i + 1$，$p_i$的概率是$1$，$1 - p_i$的概率是0.$f[i + 1][j + 1]$的概率是$p_i$，转移到$f[i + 1][0]$的概率是$1 - p_i$。第二种的权值是$0$，前者的权值是$(j + 1)^3$。不过。。。我貌似搞忘看数据范围了，$n \leq 10^6$。

所以说，$f[i]$表示到$i$位置的期望分数，$g[i]$表示到$i$的期望长度。

TODO

- HDU4405

本题目的大体意思是有n个格子，掷色子的掷出的数目就是你一次到移动格数。其中有m个飞行通道可以让你直接从第xi格飞到第yi格。问你走到终点的期望是多少。  

- HDU4336

有N种卡片，每一袋零食里面最多有一张卡片，给出一袋零食里面每种卡片的概率，问平均要买多少袋零食能收集到所有的卡片。 

- [BZOJ3143](https://www.lydsy.com/JudgeOnline/problem.php?id=3143)

首先求出每个点到达的期望次数，$x_i​$，$x_i = \sum{x_j \cdot \frac{1}{d[j]}$。列出系数矩阵，$x_n = 0$。高斯消元解出每个点到达的期望次数。然后每条边到达的期望次数是$w_k = x_i \cdot \frac{1}{d[i]} + x_j \cdot \frac{1}{d[j]}$。对期望次数从大到小排序，然后依次分配权值。

